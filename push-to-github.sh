#!/bin/bash

# рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЖрдкрдХреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛрдб рдХреЛ GitHub рдкрд░ рднреЗрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧреАред

echo "GitHub Push Helper"
echo "--------------------"

# рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ git рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ
if [ -d ".git" ]; then
  echo "Git рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИред"
else
  echo "рдПрдХ рдирдИ Git рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛ рд░рд╣рд╛ рд╣реВрдБ..."
  git init
  if [ $? -ne 0 ]; then
    echo "рддреНрд░реБрдЯрд┐: Git рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ред рдХреГрдкрдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ Git рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реИред"
    exit 1
  fi
  
  echo "рд╕рднреА рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝ рд░рд╣рд╛ рд╣реВрдБ..."
  git add .
  
  echo "рдкрд╣рд▓рд╛ рдХрдорд┐рдЯ рдмрдирд╛ рд░рд╣рд╛ рд╣реВрдБ..."
  git commit -m "Initial commit of the project"
fi

# рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рд╡рд┐рд╡рд░рдг рдорд╛рдВрдЧреЗрдВ
echo ""
echo "рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ GitHub рд╡рд┐рд╡рд░рдг рджрд░реНрдЬ рдХрд░реЗрдВ:"

read -p "рдЕрдкрдирд╛ GitHub рдпреВрдЬрд╝рд░рдиреЗрдо рджрд░реНрдЬ рдХрд░реЗрдВ: " GITHUB_USERNAME
if [ -z "$GITHUB_USERNAME" ]; then
  echo "рддреНрд░реБрдЯрд┐: GitHub рдпреВрдЬрд╝рд░рдиреЗрдо рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ред"
  exit 1
fi

read -p "рдЕрдкрдиреА GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ: " GITHUB_REPO_NAME
if [ -z "$GITHUB_REPO_NAME" ]; then
  echo "рддреНрд░реБрдЯрд┐: GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдирд╛рдо рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ред"
  exit 1
fi

echo ""
echo "рдорд╣рддреНрд╡рдкреВрд░реНрдг: рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЬрдЧрд╣ рдПрдХ Personal Access Token (PAT) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред"
echo "рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЯреЛрдХрди рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдпрд╣рд╛рдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ: https://github.com/settings/tokens/new"
echo "(рдЯреЛрдХрди рдмрдирд╛рддреЗ рд╕рдордп 'repo' рд╕реНрдХреЛрдк рдЪреБрдиреЗрдВ)"
echo ""

read -sp "рдЕрдкрдирд╛ GitHub Personal Access Token (PAT) рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ: " GITHUB_TOKEN
if [ -z "$GITHUB_TOKEN" ]; then
  echo ""
  echo "рддреНрд░реБрдЯрд┐: Personal Access Token рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ред"
  exit 1
fi

echo ""
echo ""
echo "GitHub рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд░рд╣рд╛ рд╣реВрдБ..."

# рдореМрдЬреВрджрд╛ рд░рд┐рдореЛрдЯ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ рдпрджрд┐ рдХреЛрдИ рд╣реЛ
git remote remove origin 2>/dev/null

# рдирдпрд╛ рд░рд┐рдореЛрдЯ рдЬреЛрдбрд╝реЗрдВ
REMOTE_URL="https://""$GITHUB_USERNAME"":""$GITHUB_TOKEN""@github.com/""$GITHUB_USERNAME""/""$GITHUB_REPO_NAME"".git"
git remote add origin $REMOTE_URL

echo "рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ (branch) рдХрд╛ рдирд╛рдо 'main' рд░рдЦ рд░рд╣рд╛ рд╣реВрдБ..."
git branch -M main

echo "рдХреЛрдб рдХреЛ GitHub рдкрд░ рднреЗрдЬ рд░рд╣рд╛ рд╣реВрдБ (Pushing)..."
git push -u origin main

if [ $? -eq 0 ]; then
  echo ""
  echo "ЁЯОЙ рд╕рдлрд▓рддрд╛! рдЖрдкрдХрд╛ рдХреЛрдб рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ GitHub рдкрд░ рднреЗрдЬ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред"
  echo "рдЖрдк рдЗрд╕реЗ рдпрд╣рд╛рдБ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: https://github.com/$GITHUB_USERNAME/$GITHUB_REPO_NAME"
else
  echo ""
  echo "тЭМ рддреНрд░реБрдЯрд┐: рдХреЛрдб рдХреЛ GitHub рдкрд░ рднреЗрдЬрдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ред"
  echo "рдХреГрдкрдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХрд╛ рдпреВрдЬрд╝рд░рдиреЗрдо, рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдирд╛рдо рдФрд░ Personal Access Token рд╕рд╣реА рд╣реИрдВред"
  # рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдпреВрдЖрд░рдПрд▓ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ
  git remote remove origin
fi
